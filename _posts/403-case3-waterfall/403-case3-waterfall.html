<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="radix" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

  <!--radix_placeholder_meta_tags-->
  <title>Why a waterfall plot?</title>
  
  <meta property="description" itemprop="description" content="Questioning the defaults."/>
  
  
  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2019-10-02"/>
  <meta property="article:created" itemprop="dateCreated" content="2019-10-02"/>
  <meta name="article:author" content="Marc Vandemeulebroecke"/>
  <meta name="article:author" content="Mark Baillie"/>
  <meta name="article:author" content="Alison Margolskee"/>
  <meta name="article:author" content="Baldur Magnusson"/>
  
  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Why a waterfall plot?"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="Questioning the defaults."/>
  <meta property="og:locale" content="en_US"/>
  
  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Why a waterfall plot?"/>
  <meta property="twitter:description" content="Questioning the defaults."/>
  
  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","categories","draft","output"]}},"value":[{"type":"character","attributes":{},"value":["Why a waterfall plot?"]},{"type":"character","attributes":{},"value":["Questioning the defaults.\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Marc Vandemeulebroecke"]},{"type":"character","attributes":{},"value":["https://graphicsprinciples.github.io/"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Mark Baillie"]},{"type":"character","attributes":{},"value":["https://graphicsprinciples.github.io/"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Alison Margolskee"]},{"type":"character","attributes":{},"value":["https://graphicsprinciples.github.io/"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Baldur Magnusson"]},{"type":"character","attributes":{},"value":["https://graphicsprinciples.github.io/"]}]}]},{"type":"character","attributes":{},"value":["2019-10-02"]},{"type":"character","attributes":{},"value":["case studies","example code","waterfall plot","defaults"]},{"type":"logical","attributes":{},"value":[false]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["radix::radix_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained"]}},"value":[{"type":"logical","attributes":{},"value":[false]}]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["403-case3-waterfall_files/bowser-1.9.3/bowser.min.js","403-case3-waterfall_files/distill-2.2.21/template.v2.js","403-case3-waterfall_files/figure-html5/unnamed-chunk-1-1.png","403-case3-waterfall_files/figure-html5/unnamed-chunk-2-1.png","403-case3-waterfall_files/figure-html5/unnamed-chunk-3-1.png","403-case3-waterfall_files/figure-html5/unnamed-chunk-4-1.png","403-case3-waterfall_files/figure-html5/unnamed-chunk-5-1.png","403-case3-waterfall_files/jquery-1.11.3/jquery.min.js","403-case3-waterfall_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->
  
  <style type="text/css">
  
  body {
    background-color: white;
  }
  
  .pandoc-table {
    width: 100%;
  }
  
  .pandoc-table>caption {
    margin-bottom: 10px;
  }
  
  .pandoc-table th:not([align]) {
    text-align: left;
  }
  
  .pagedtable-footer {
    font-size: 15px;
  }
  
  .html-widget {
    margin-bottom: 2.0em;
  }
  
  .l-screen-inset {
    padding-right: 16px;
  }
  
  .l-screen .caption {
    margin-left: 10px;
  }
  
  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .shaded-content {
    background: white;
  }
  
  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }
  
  .hidden {
    display: none !important;
  }
  
  d-article {
    padding-bottom: 30px;
  }
  
  d-appendix {
    padding-top: 30px;
  }
  
  d-article>p>img {
    width: 100%;
  }
  
  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }
  
  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  /* CSS for table of contents */
  
  .d-toc {
    color: rgba(0,0,0,0.8);
    font-size: 0.8em;
    line-height: 1em;
  }
  
  .d-toc-header {
    font-size: 0.6rem;
    font-weight: 400;
    color: rgba(0, 0, 0, 0.5);
    text-transform: uppercase;
    margin-top: 0;
    margin-bottom: 1.3em;
  }
  
  .d-toc a {
    border-bottom: none;
  }
  
  .d-toc ul {
    padding-left: 0;
  }
  
  .d-toc li>ul {
    padding-top: 0.8em;
    padding-left: 16px;
    margin-bottom: 0.6em;
  }
  
  .d-toc ul,
  .d-toc li {
    list-style-type: none;
  }
  
  .d-toc li {
    margin-bottom: 0.9em;
  }
  
  .d-toc-separator {
    margin-top: 20px;
    margin-bottom: 2em;
  }
  
  .d-article-with-toc {
    border-top: none;
    padding-top: 0;
  }
  
  
  
  /* Tweak code blocks (note that this CSS is repeated above in an injection
     into the d-code shadow dom) */
  
  d-code {
    overflow-x: auto !important;
  }
  
  pre.d-code code.d-code {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }
  
  pre.text-output {
  
    font-size: 12px;
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  @media(min-width: 768px) {
  
  d-code {
    overflow-x: visible !important;
  }
  
  pre.d-code code.d-code  {
      padding-left: 18px;
      font-size: 14px;
  }
  pre.text-output {
    font-size: 14px;
  }
  }
  
  /* Figure */
  
  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }
  
  .figure img {
    width: 100%;
  }
  
  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }
  
  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }
  
  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }
  
  
  
  /* Tweak 1000px media break to show more text */
  
  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }
  
    .grid {
      grid-column-gap: 16px;
    }
  
    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }
  
  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }
  
    .grid {
      grid-column-gap: 32px;
    }
  }
  
  
  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */
  
  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }
  
  
  /* Social footer */
  
  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }
  
  .disqus-comments {
    margin-right: 30px;
  }
  
  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }
  
  #disqus_thread {
    margin-top: 30px;
  }
  
  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }
  
  .article-sharing a:hover {
    border-bottom: none;
  }
  
  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }
  
  .subscribe p {
    margin-bottom: 0.5em;
  }
  
  
  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }
  
  
  /* Improve display for browsers without grid (IE/Edge <= 15) */
  
  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }
  
  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }
  
  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }
  
  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }
  
  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }
  
  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }
  
  
  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }
  
  .downlevel .footnotes ol {
    padding-left: 13px;
  }
  
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }
  
  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }
  
  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }
  
  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  </style>
  
  <script type="application/javascript">
  
  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }
  
  // show body when load is complete
  function on_load_complete() {
  
    // set body to visible
    document.body.style.visibility = 'visible';
  
    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }
  
    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }
  
  function init_distill() {
  
    init_common();
  
    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);
  
    // create d-title
    $('.d-title').changeElementType('d-title');
  
    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);
  
    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();
  
    // move posts container into article
    $('.posts-container').appendTo($('d-article'));
  
    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');
  
    // create d-bibliography
    var bibliography = $('<d-bibliography></d-bibliography>');
    $('#distill-bibliography').wrap(bibliography);
  
    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;
  
    // replace citations with <d-cite>
    $('.citation').each(function(i, val) {
      appendix = true;
      var cites = $(this).attr('data-cites').split(" ");
      var dt_cite = $('<d-cite></d-cite>');
      dt_cite.attr('key', cites.join());
      $(this).replaceWith(dt_cite);
    });
    // remove refs
    $('#refs').remove();
  
    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();
  
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-toc a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });
  
    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');
  
    // replace code blocks with d-code
    $('pre>code').each(function(i, val) {
      var code = $(this);
      var pre = code.parent();
      var clz = "";
      var language = pre.attr('class');
      if (language) {
        // map unknown languages to "clike" (without this they just dissapear)
        if ($.inArray(language, ["bash", "clike", "css", "go", "html",
                                 "javascript", "js", "julia", "lua", "markdown",
                                 "markup", "mathml", "python", "svg", "xml"]) == -1)
          language = "clike";
        language = ' language="' + language + '"';
        var dt_code = $('<d-code block' + language + clz + '></d-code>');
        dt_code.text(code.text());
        pre.replaceWith(dt_code);
      } else {
        code.addClass('text-output').unwrap().changeElementType('pre');
      }
    });
  
    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {
  
      // capture layout
      var layout = $(this).attr('data-layout');
  
      // apply layout to markdown level block elements
      var elements = $(this).children().not('d-code, pre.text-output, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });
  
  
      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });
  
    // load distill framework
    load_distill_framework();
  
    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {
  
      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;
  
      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');
  
      // table of contents
      if (have_authors) // adjust border if we are in authors
        $('.d-toc').parent().addClass('d-article-with-toc');
  
      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');
  
      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }
  
      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');
  
      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");
  
      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }
  
       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }
  
      // inject pre code styles (can't do this with a global stylesheet b/c a shadow root is used)
      $('d-code').each(function(i, val) {
        var style = document.createElement('style');
        style.innerHTML = 'pre code { padding-left: 10px; font-size: 12px; border-left: 2px solid rgba(0,0,0,0.1); } ' +
                          '@media(min-width: 768px) { pre code { padding-left: 18px; font-size: 14px; } }';
        if (this.shadowRoot)
          this.shadowRoot.appendChild(style);
      });
  
      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();
  
      // clear polling timer
      clearInterval(tid);
  
      // show body now that everything is ready
      on_load_complete();
    }
  
    var tid = setInterval(distill_post_process, 50);
    distill_post_process();
  
  }
  
  function init_downlevel() {
  
    init_common();
  
     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));
  
    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
  
    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();
  
    // remove toc
    $('.d-toc-header').remove();
    $('.d-toc').remove();
    $('.d-toc-separator').remove();
  
    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });
  
  
    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);
  
    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);
  
    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();
  
    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();
  
    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));
  
    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });
  
    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));
  
    $('body').addClass('downlevel');
  
    on_load_complete();
  }
  
  
  function init_common() {
  
    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};
  
        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });
  
        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);
  
    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});
  
    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });
  
      }
    });
  
    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });
  
    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.radix-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }
  
    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');
  
    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");
  
    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();
  
    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }
  
  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });
  
  </script>
  
  <!--/radix_placeholder_distill-->
  <script src="403-case3-waterfall_files/jquery-1.11.3/jquery.min.js"></script>
  <script src="403-case3-waterfall_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="403-case3-waterfall_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="403-case3-waterfall_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Why a waterfall plot?","description":"Questioning the defaults.","authors":[{"author":"Marc Vandemeulebroecke","authorURL":"https://graphicsprinciples.github.io/","affiliation":"&nbsp;","affiliationURL":"#"},{"author":"Mark Baillie","authorURL":"https://graphicsprinciples.github.io/","affiliation":"&nbsp;","affiliationURL":"#"},{"author":"Alison Margolskee","authorURL":"https://graphicsprinciples.github.io/","affiliation":"&nbsp;","affiliationURL":"#"},{"author":"Baldur Magnusson","authorURL":"https://graphicsprinciples.github.io/","affiliation":"&nbsp;","affiliationURL":"#"}],"publishedDate":"2019-10-02T00:00:00.000+02:00","citationText":"Vandemeulebroecke, et al., 2019"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Why a waterfall plot?</h1>
<p>Questioning the defaults.</p>
</div>

<div class="d-byline">
  Marc Vandemeulebroecke <a href="https://graphicsprinciples.github.io/" class="uri">https://graphicsprinciples.github.io/</a> 
  
,   Mark Baillie <a href="https://graphicsprinciples.github.io/" class="uri">https://graphicsprinciples.github.io/</a> 
  
,   Alison Margolskee <a href="https://graphicsprinciples.github.io/" class="uri">https://graphicsprinciples.github.io/</a> 
  
,   Baldur Magnusson <a href="https://graphicsprinciples.github.io/" class="uri">https://graphicsprinciples.github.io/</a> 
  
<br/>2019-10-02
</div>

<div class="d-article">
<p>This case study illustrates the importance of aligning a graph with the scientific question it should address, the option of filtering signals through a model, and finally the display of a scientific answer in a condensed messaging graph.</p>
<p>Consider a small early development trial, randomized and placebo-controlled (2:1 randomization), with a continuous primary endpoint measured at baseline and longitudinally over a period of 4 weeks. Lower outcome values are better, and there are no dropouts and no missing data. Suppose that the team is interested in the effect of the drug at the last measurement time point, as it is often the case. A common approach in early development trials is to simply plot the observed change scores in a so-called “waterfall plot” such as Figure 1.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(t4dat, aes(x = sort_id, y = cfb, fill = factor(ztext))) +
  geom_col(alpha = 0.8) +
  scale_fill_brewer(palette = &quot;Dark2&quot;, name = &quot;Treatment&quot;) +
  paper_theme() +
  theme(
    legend.position = c(0.8, 0.2),
    legend.background = element_blank(),
    legend.title = element_blank(),
    axis.ticks.x = element_blank(),
    axis.text.x = element_blank(),
    panel.grid.major.x = element_blank(),
    panel.border = element_rect(color = &quot;grey&quot;, fill = NA)
  ) +
  labs(x = &quot;Subject&quot;, y = &quot;Change from baseline&quot;,
       title = &quot;Week 4 outcome by treatment&quot;)</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-1"></span>
<img src="403-case3-waterfall_files/figure-html5/unnamed-chunk-1-1.png" alt="Waterfall plot of week 4 outcome" width="624" />
<p class="caption">
Figure 1: Waterfall plot of week 4 outcome
</p>
</div>
</div>
<p>To probe <a href="https://graphicsprinciples.github.io/tutorial-case-studies/posts/201-three-laws-vizcom/#law-1-have-a-clear-purpose">Law 1</a>, what is the question addressed by this plot? It asks about the treatment effect after 4 weeks of treatment. Is this the right question? Let us assume for a moment that it is. Then a waterfall plot is <a href="https://onlinelibrary.wiley.com/doi/abs/10.1002/pst.1944?af=R">not ideal for addressing it</a>. Small treatment effects are difficult to discern, especially with an unbalanced randomization ratio. The audience must observe the distribution of color across the entire plot just to determine which treatment is more beneficial; this can become even more difficult with a larger sample size or more than two treatment groups. In Figure 1, one might see a treatment benefit, but how large is it and how certain of it are we? The popularity of waterfall plots is a mystery.</p>
<p>If we insist on week 4 as the only time point of interest, we could present overlaid density plots or side-by-side boxplots for a better appreciation of the difference in distribution between the two treatment arms. Figure 2 shows an example with the raw data points included, which is a much better alternative to Figure 1. The side-by-side placement facilitates the treatment comparison, and the plot is simple, familiar and uses minimal ink for what it shows. Graphical attributes (colors, font size, etc.) are easily readable.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(data = t4dat, aes(x = ztext, y = cfb, colour = ztext)) +
  geom_boxplot(width = 0.25) +
  geom_jitter(alpha = 0.25, width = 0.1) +
  scale_colour_brewer(palette = &quot;Dark2&quot;) +
  labs(x = &quot;&quot;, y = &quot;Change from baseline&quot;) +
  paper_theme() +
  theme(legend.position = &quot;none&quot;) +
  labs(x = &quot;&quot;, y = &quot;Change from baseline&quot;,
       title = &quot;Week 4 outcome&quot;) +
  theme(
    panel.border = element_rect(color = &quot;grey&quot;, fill = NA, size = 0.25),
    plot.title = element_text(size = 12),
    axis.text.y = element_text(size = 8),
    axis.text.x = element_text(size = 10),
    axis.title.y = element_text(size = 10),
    axis.ticks.x = element_blank(),
    panel.grid.major.x = element_blank()
  )</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-2"></span>
<img src="403-case3-waterfall_files/figure-html5/unnamed-chunk-2-1.png" alt="Boxplots of week 4 outcome" width="624" />
<p class="caption">
Figure 2: Boxplots of week 4 outcome
</p>
</div>
</div>
<p>However, with such rich longitudinal data, it may be more informative to ask the question about the treatment effect during – not just after – the first 4 weeks of treatment. This is especially relevant in the early, more exploratory development phase (and it would be even more relevant if there were dropouts). As a rule, the recommended first step is to visualize the totality of the data. Figure 3 does this and includes means by treatment and time point. We see large inter-individual variability and overlap between the treatment groups. We also start to get an appreciation for the time-course of a mean effect. We see linear trajectories of the means over time, with the active arm appearing to improve and the placebo arm staying fairly constant. We cannot exclude that the apparent gap might continue to increase beyond 4 weeks of treatment. This plot, while doing little more than displaying the raw data, is already worth sharing with the project team. It facilitates a much richer understanding of the data than the previous two plots. It shows the data clearly i.e. <a href="https://graphicsprinciples.github.io/tutorial-case-studies/posts/201-three-laws-vizcom/#law-2-show-the-data-clearly">Law 2</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
md &lt;- dres %&gt;%
  group_by(time, ztext) %&gt;%
  summarise(
    m = mean(y),
    s = sd(y),
    n = n(),
    se = s / sqrt(n)
  )

ggplot() +
  theme(legend.position = c(0.8, 0.65),
        legend.background = element_blank()) +
  geom_line(data = dres,
            aes(
              x = time,
              y = y,
              group = id,
              colour = factor(ztext)
            ),
            alpha = 0.35) +
  geom_line(data = md,
            aes(
              x = time,
              y = m,
              colour = factor(ztext)
            ),
            size = 1) +
  geom_point(data = md, aes(
    x = time,
    y = m,
    ymin = m - s,
    ymax = m + s,
    colour = ztext
  )) +
  scale_y_continuous(limits = c(min(dres$y) - 2.5, max(dres$y))) +
  scale_colour_brewer(palette = &quot;Dark2&quot;, name = &quot;&quot;) +
  labs(x = &quot;Week&quot;, y = &quot;Outcome&quot;,
       title = &quot;Longitudinal individual outcomes \nwith group means&quot;) +
  paper_theme() +
  theme(
    panel.border = element_rect(color = &quot;grey&quot;, fill = NA, size = 0.25),
    plot.title = element_text(size = 10),
    axis.text.y = element_text(size = 8),
    axis.text.x = element_text(size = 8),
    axis.title.y = element_text(size = 10),
    axis.title.x = element_text(size = 10),
    legend.position = c(0.15, 0.225),
    legend.background = element_blank()
  )</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-3"></span>
<img src="403-case3-waterfall_files/figure-html5/unnamed-chunk-3-1.png" alt="Spaghetti plots &amp; mean +/- SD" width="624" />
<p class="caption">
Figure 3: Spaghetti plots &amp; mean +/- SD
</p>
</div>
</div>
<p>Depending on the goal of the analysis, we could stop here. But if we want to quantify the treatment difference while adjusting for important covariates, we should proceed with a statistical model. Based on Figure 3 a linear model appears appropriate. We fit a linear model with treatment, patient-specific intercept and slope, and we now also adjust for the baseline value of the primary endpoint and for any other important covariates. We can then visualize the data filtered through this model, omitting the raw data but displaying longitudinal point estimates and some form of uncertainty intervals for both treatment groups (Figure 4). This gets closer to the nature of a messaging graph, focusing directly on the results of our model. Optionally – and depending on the audience! – we could even go one final step further and display the treatment difference directly, as in Figure 5. This plot addresses the question about the treatment effect over time without requiring any mental arithmetic. We can read off approximate estimates for the treatment effect, and the level of confidence is easily appreciable from the added confidence band (which does include zero!). Appropriate and parsimonious annotations make the message even more obvious, <a href="https://graphicsprinciples.github.io/tutorial-case-studies/posts/201-three-laws-vizcom/#law-3-make-the-message-obvious">Law 3</a>, also through “effectively redundant” information (stating what can be seen).</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
## Model fit to longtiduinal data
adat &lt;- dres %&gt;%
  filter(time &gt; 0)

mod &lt;-
  stan_lmer(
    y ~ time * factor(z) + baseline + x1 + x2 + (time | id),
    data = adat,
    chains = 4,
    iter = 500,
    cores = 4
  )

nd1 &lt;- dres %&gt;%
  select(id, time, baseline, x1, x2, z)

nd2 &lt;- dres %&gt;%
  select(id, time, baseline, x1, x2, z) %&gt;%
  mutate(z = 1 - z)

nd &lt;- bind_rows(nd1, nd2) %&gt;%
  arrange(id, time, z)

prs &lt;- c(0.05, 0.5, 0.95)

ppnd &lt;- nd %&gt;% select(id, time, z) %&gt;%
  bind_cols(as_tibble(t(
    posterior_linpred(mod, newdata = nd, re.form =  ~ 0)
  ))) %&gt;%
  gather(4:1003, key = &quot;ppid&quot;, value = &quot;ypred&quot;) %&gt;%
  spread(z, ypred) %&gt;%
  mutate(contr = `1` - `0`) %&gt;%
  group_by(ppid, time) %&gt;%
  do({
    m0 &lt;- mean(.$`0`)
    m1 &lt;- mean(.$`1`)
    mc &lt;- mean(.$contr)
    as_tibble(cbind(m0, m1, mc))
  }) %&gt;%
  ungroup() %&gt;%
  group_by(time) %&gt;%
  do({
    q0 &lt;- t(quantile(.$m0, probs = prs))
    q1 &lt;- t(quantile(.$m1, probs = prs))
    contr &lt;- t(quantile(.$mc, probs = prs))
    as_tibble(rbind(q0, q1, contr)) %&gt;%
      mutate(var = c(&quot;Placebo&quot;, &quot;Active&quot;, &quot;Contrast&quot;))
  })

## Treatment difference, median &amp; 90% CI errorbars
ppnd %&gt;%
  filter(var != &quot;Contrast&quot;) %&gt;%
  ggplot(aes(
    x = time,
    y = `50%`,
    ymin = `5%`,
    ymax = `95%`,
    colour = factor(var, levels = c(&quot;Placebo&quot;, &quot;Active&quot;))
  )) +
  geom_pointrange(position = position_dodge(width = 0.3)) +
  geom_line(position = position_dodge(width = 0.3)) +
  scale_color_brewer(palette = &quot;Dark2&quot;, name = &quot;&quot;) +
  paper_theme() +
  theme(legend.position = c(0.15, 0.245),
        legend.background = element_blank()) +
  theme(
    panel.border = element_rect(color = &quot;grey&quot;, fill = NA, size = 0.25),
    plot.title = element_text(size = 10, margin = rep(unit(
      0.01 * 234, &quot;mm&quot;
    ), 3)),
    plot.subtitle = element_text(
      size = 8,
      color = rgb(0.3, 0.3, 0.3),
      margin = rep(unit(0.001 * 234, &quot;mm&quot;), 3)
    ),
    axis.text.y = element_text(size = 8),
    axis.text.x = element_text(size = 8),
    axis.title.y = element_text(size = 10),
    axis.title.x = element_text(size = 10)
  ) +
  labs(
    x = &quot;Week&quot;,
    y = &quot;Outcome&quot;,
    title = &quot;Active group improves over time&quot;,
    subtitle = &quot;Posterior median (90% credible interval)&quot;
  )</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-4"></span>
<img src="403-case3-waterfall_files/figure-html5/unnamed-chunk-4-1.png" alt="Treatment difference, median &amp; 90% CI errorbars" width="624" />
<p class="caption">
Figure 4: Treatment difference, median &amp; 90% CI errorbars
</p>
</div>
</div>
<p>It is worth emphasizing that this last plot should not be the only one generated, and probably not the only one shown either. Strongly reduced messaging graphs require a robust understanding of the underlying data, which can only be built through a workflow such as the one described above. Further, depending on the situation and the audience, they might be challenged as loaded or unscientific. (E.g., the apparently perfect linear trend in Figure 5 appears “unrealistic”.) It is therefore important to ensure and emphasize that this last plot derives from a model which (as every model) is intended to separate the signal from the noise, and that the choice of this model is justified by a thorough inspection of the data.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ppnd %&gt;%
  filter(var == &quot;Contrast&quot; &amp; time &gt; 0) %&gt;%
  ggplot(aes(x = time, y = `50%`)) +
  geom_ribbon(aes(ymin = `5%`, ymax = `95%`), fill = &quot;black&quot;, alpha = 0.15) +
  geom_point(size = 1.5) + geom_line(size = 1) +
  geom_hline(yintercept = 0, linetype = 2)  +
  labs(
    x = &quot;Week&quot;,
    y = &quot;Treatment difference&quot;,
    title = &quot;Treatment effect increases over time&quot;,
    subtitle = &quot;Posterior median (90% credible interval)&quot;
  ) +
  geom_segment(
    aes(
      x = 0.98,
      y = -0.01,
      xend = 0.98,
      yend = -3.5
    ),
    arrow = arrow(length = unit(0.02 * 234, &quot;mm&quot;)),
    alpha = 0.25
  ) +
  annotate(
    &quot;text&quot;,
    label = &quot;Greater benefit&quot;,
    x = 1.4,
    y = -3.4,
    size = 5,
    alpha = 0.75
  ) +
  paper_theme() +
  theme(
    panel.border = element_rect(color = &quot;grey&quot;, fill = NA, size = 0.25),
    plot.subtitle = element_text(size = 10, color = rgb(0.3, 0.3, 0.3))
  )</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-5"></span>
<img src="403-case3-waterfall_files/figure-html5/unnamed-chunk-5-1.png" alt="Treatment difference, median &amp; 90% CI ribbon" width="624" />
<p class="caption">
Figure 5: Treatment difference, median &amp; 90% CI ribbon
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
sessionInfo()</code></pre>
<pre><code>
## R version 3.5.3 (2019-03-11)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 10 x64 (build 16299)
## 
## Matrix products: default
## 
## locale:
## [1] LC_COLLATE=English_United States.1252 
## [2] LC_CTYPE=English_United States.1252   
## [3] LC_MONETARY=English_United States.1252
## [4] LC_NUMERIC=C                          
## [5] LC_TIME=English_United States.1252    
## 
## attached base packages:
## [1] grid      stats     graphics  grDevices utils    
## [6] datasets  methods   base     
## 
## other attached packages:
##  [1] RColorBrewer_1.1-2 data.table_1.12.2 
##  [3] gridExtra_2.3      rstanarm_2.18.2   
##  [5] Rcpp_1.0.1         caTools_1.17.1.2  
##  [7] RxODE_0.8.0-9      forcats_0.4.0     
##  [9] stringr_1.4.0      dplyr_0.8.0.1     
## [11] purrr_0.3.2        readr_1.3.1       
## [13] tidyr_0.8.3        tibble_2.1.1      
## [15] ggplot2_3.1.1      tidyverse_1.2.1   
## 
## loaded via a namespace (and not attached):
##  [1] minqa_1.2.4        colorspace_1.4-1  
##  [3] ggridges_0.5.1     rsconnect_0.8.13  
##  [5] markdown_0.9       base64enc_0.1-3   
##  [7] rstudioapi_0.10    rstan_2.18.2      
##  [9] DT_0.5             lubridate_1.7.4   
## [11] xml2_1.2.0         codetools_0.2-16  
## [13] splines_3.5.3      knitr_1.22        
## [15] shinythemes_1.1.2  bayesplot_1.6.0   
## [17] jsonlite_1.6       nloptr_1.2.1      
## [19] broom_0.5.2        shiny_1.3.0       
## [21] compiler_3.5.3     httr_1.4.0        
## [23] backports_1.1.3    assertthat_0.2.1  
## [25] Matrix_1.2-17      lazyeval_0.2.2    
## [27] cli_1.1.0          later_0.8.0       
## [29] htmltools_0.3.6    prettyunits_1.0.2 
## [31] tools_3.5.3        igraph_1.2.4      
## [33] gtable_0.3.0       glue_1.3.1        
## [35] reshape2_1.4.3     cellranger_1.1.0  
## [37] radix_0.6          nlme_3.1-137      
## [39] crosstalk_1.0.0    xfun_0.6          
## [41] ps_1.3.0           lme4_1.1-21       
## [43] rvest_0.3.2        mime_0.6          
## [45] miniUI_0.1.1.1     gtools_3.8.1      
## [47] MASS_7.3-51.4      zoo_1.8-5         
## [49] scales_1.0.0       colourpicker_1.0  
## [51] hms_0.4.2          promises_1.0.1    
## [53] rex_1.1.2          parallel_3.5.3    
## [55] inline_0.3.15      shinystan_2.5.0   
## [57] yaml_2.2.0         mvnfast_0.2.5     
## [59] memoise_1.1.0      loo_2.1.0         
## [61] StanHeaders_2.18.1 stringi_1.4.3     
## [63] highr_0.8          dygraphs_1.1.1.6  
## [65] boot_1.3-20        pkgbuild_1.0.3    
## [67] rlang_0.4.0        pkgconfig_2.0.2   
## [69] PreciseSums_0.3    bitops_1.0-6      
## [71] matrixStats_0.54.0 evaluate_0.13     
## [73] lattice_0.20-38    labeling_0.3      
## [75] rstantools_1.5.1   htmlwidgets_1.3   
## [77] tidyselect_0.2.5   processx_3.3.0    
## [79] plyr_1.8.4         magrittr_1.5      
## [81] R6_2.4.0           generics_0.0.2    
## [83] pillar_1.3.1       haven_2.1.0       
## [85] withr_2.1.2        xts_0.11-2        
## [87] survival_2.44-1.1  modelr_0.1.4      
## [89] crayon_1.3.4       rmarkdown_1.12    
## [91] readxl_1.3.1       callr_3.2.0       
## [93] threejs_0.3.1      digest_0.6.20     
## [95] xtable_1.8-3       httpuv_1.5.1      
## [97] stats4_3.5.3       munsell_0.5.0     
## [99] shinyjs_1.0</code></pre>
</div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
